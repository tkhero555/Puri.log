<% content_for :title, "マイページ" %>
<div class="bg-base-200 space-y-10 pt-4 pb-4">
  <div class="mx-auto grid grid-cols-1 md:grid-cols-2-minmax xl:grid-cols-3-minmax xl:w-5/6 gap-12">
    <div class="card min-w-96 bg-base-100 shadow-xl mx-auto">
      <div class="card-body">
        <h2 class="card-title">食事の記録</h2>
        <%= form_with url: meals_path, class: "w-full max-w-md" do |f| %>
          <div class="md:flex md:items-center mb-6" data-controller="autocomplete" data-autocomplete-url-value="/users/search" role="combobox">
            <div class="md:w-1/3">
              <%= f.label :meal_name, "食事名", class: "block text-gray-500 font-bold md:text-right mb-1 md:mb-0 pr-4" %>
            </div>
            <div class="md:w-2/3">
              <%= f.text_field :new_meal_name, class: "bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-black", data: { autocomplete_target: "input" } %>
              <%= f.hidden_field :meal_name, data: { autocomplete_target: "hidden" } %>
              <ul class="list-group" data-autocomplete-target="results"></ul>
            </div>
          </div>
          <div class="md:flex md:items-center mb-6">
            <div class="md:w-1/3">
              <%= f.label :meal_created_at, "食べた時間", class: "block text-gray-500 font-bold md:text-right mb-1 md:mb-0 pr-4" %>
            </div>
            <div class="md:w-2/3">
              <%= f.datetime_field :meal_created_at, value: Time.current.strftime('%Y-%m-%dT'), class: "bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-black" %>
            </div>
          </div>
          <div class="flex items-center">
            <div class="w-1/3"></div>
            <div class="w-2/3">
              <%= f.submit "記録する", data: { turbo_frame: "meal_form_frame" }, class: "btn btn-ghost shadow bg-primary-content hover:bg-base-400 focus:shadow-outline focus:outline-none font-bold py-2 px-4 rounded-full meal-btn" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    <div class="card min-w-96 bg-base-100 shadow-xl mx-auto">
      <div class="card-body">
        <h2 class="card-title">排便の記録</h2>
        <%= form_with url: stools_path, class: "w-full max-w-md" do |f| %>
          <div class="md:flex md:items-center mb-6">
            <div class="md:w-1/3">
              <%= f.label :condition, "便の状態", class: "block text-gray-500 font-bold md:text-right mb-1 md:mb-0 pr-4" %>
            </div>
            <div class="md:w-2/3">
              <%= f.select :condition, [["0.良い", 0], ["1.普通", 1], ["2.悪い", 2]], {include_blank: "選択して下さい"}, class: "bg-gray-200 border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-black" %>
            </div>
          </div>
          <div class="md:flex md:items-center mb-6">
            <div class="md:w-1/3">
              <%= f.label :created_at, "出した日時", class: "block text-gray-500 font-bold md:text-right mb-1 md:mb-0 pr-4" %>
            </div>
            <div class="md:w-2/3">
              <%= f.datetime_field :created_at, value: Time.current.strftime('%Y-%m-%dT'), class: "bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-black" %>
            </div>
          </div>
          <div class="flex items-center">
            <div class="w-1/3"></div>
            <div class="w-2/3">
              <%= f.submit "記録する", class: "btn btn-ghost shadow bg-primary-content hover:bg-base-400 focus:shadow-outline focus:outline-none font-bold py-2 px-4 rounded-full stool-btn" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    <div class="card w-96 max-h-96 bg-base-100 shadow-xl mx-auto">
      <div class="card-body">
        <h2 class="card-title">マイスコア</h2>
        <div class="flex items-center justify-center text-9xl my-score">
          <%= @log_count %>
        </div>
        <div class="text-right text-xl">ポイント</div>
      </div>
    </div>
    <div class="card w-96 max-h-96 bg-base-100 shadow-xl mx-auto">
      <div class="card-body">
        <h2 class="card-title">連続記録日数</h2>
        <h3><strong>食事の連続記録日数</strong></h3>
        <div class="flex items-center justify-center text-7xl meal-log-days-record">
          <%= @meal_log_days_record %>
        </div>
        <div class="text-right text-3xl">日</div>
        <h3><strong>排便の連続記録日数</strong></h3>
        <div class="flex items-center justify-center text-7xl stool-log-days-record">
          <%= @stool_log_days_record %>
        </div>
        <div class="text-right text-3xl">日</div>
      </div>
    </div>
    <div class="card w-96 max-h-96 bg-base-100 shadow-xl mx-auto">
      <div class="card-body">
        <h2 class="card-title">おすすめの食事</h2>
        <div class="max-h-72 overflow-auto recommend-meal">
          <% @recommend_meals.each do |recommend_meal| %>
            <%= recommend_meal.meal_name %>
          <% end %>
        </div>
      </div>
    </div>
    <div class="card w-96 max-h-96 bg-base-100 shadow-xl mx-auto">
      <div class="card-body">
        <h2 class="card-title">避けるべき食事</h2>
        <div class="max-h-72 overflow-auto avert-meal">
          <% @avert_meals.each do |avert_meal| %>
            <%= avert_meal.meal_name %>
          <% end %>
        </div>
      </div>
    </div>
    <div class="card w-96 max-h-96 bg-base-100 shadow-xl mx-auto">
      <div class="card-body">
        <h2 class="card-title">記録回数の実績</h2>
        <div class="max-h-72 overflow-auto log-count">
          <h3><strong>通算</strong></h3>
            <p>食事：<%= @eating_count %> 回</p>
            <p>排便：<%= @stool_count %> 回</p>
          <h3><strong>今月</strong></h3>
            <p>食事：<%= @this_month_eating_count %> 回</p>
            <p>排便：<%= @this_month_stool_count %> 回</p>
          <h3><strong>先月</strong></h3>
            <p>食事：<%= @last_month_eating_count %> 回</p>
            <p>排便：<%= @last_month_stool_count %> 回</p>
        </div>
      </div>
    </div>
    <div class="card w-96 max-h-96 bg-base-100 shadow-xl mx-auto">
      <div class="card-body">
        <h2 class="card-title">登録済みの食事名一覧</h2>
        <div class="max-h-72 overflow-auto meal-log-index">
          <table class="table table-xs table-pin-rows table-pin-cols">
            <thead>
              <tr>
                <th></th> 
                <td>食事名</td> 
                <td>記録回数</td> 
                <th></th> 
              </tr>
            </thead> 
            <% @meals.each do |meal| %>
              <% meal_id = meal.id %>
              <tbody>
                <tr>
                  <th></th>
                  <td><%= meal.meal_name %></td>
                  <td><%= @my_meal_count[meal_id] %></td>
                  <th></th>
                </tr>
              </tbody>
            <% end %>
          </table>
        </div>
      </div>
    </div>
    <div class="card w-96 max-h-96 bg-base-100 shadow-xl mx-auto">
      <div class="card-body">
        <h2 class="card-title">胃腸の状況</h2>
        <div class="max-h-72 overflow-auto stomach-condition">
          <h3><strong>便の状態ごとの記録回数(通算)</strong></h3>
            <p>良い：<%= @stool_good_count %> 回</p>
            <p>普通：<%= @stool_normal_count %> 回</p>
            <p>悪い：<%= @stool_bad_count %> 回</p>
          <h3><strong>便の状態ごとの記録回数(今月)</strong></h3>
            <p>良い：<%= @this_month_stool_good_count %> 回</p>
            <p>普通：<%= @this_month_stool_normal_count %> 回</p>
            <p>悪い：<%= @this_month_stool_bad_count %> 回</p>
          <h3><strong>便の状態ごとの記録回数(先月)</strong></h3>
            <p>良い：<%= @last_month_stool_good_count %> 回</p>
            <p>普通：<%= @last_month_stool_normal_count %> 回</p>
            <p>悪い：<%= @last_month_stool_bad_count %> 回</p>
        </div>
      </div>
    </div>
    <%= turbo_frame_tag "log_index_frame" do %>
      <%= render 'shared/log_index' %>
    <% end %>
    <div class="card w-96 max-h-96 bg-base-100 shadow-xl mx-auto">
      <div class="card-body">
        <h2 class="card-title">セッティング</h2>
        <div>
          <%= link_to (current_user.notifications_enabled ? "通知をオフにする" : "通知をオンにする"), toggle_notifications_path, data: { turbo_method: :post }, class: "bg-primary-content hover:bg-base-200 font-bold py-2 px-4 rounded-full w-20 notifications-btn" %>
        </div>
        <div class="pt-4">
          <% unless current_user.id == @recorded_test_user_id %>
            <%= link_to 'ユーザーデータ削除', user_path(current_user), data: { turbo_method: :delete, turbo_confirm: '元には戻せませんが、本当に削除しますか？' }, class: "bg-red-600 hover:bg-base-200 font-bold py-2 px-4 rounded-full w-20 notifications-btn border-2 border-black text-black" %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
